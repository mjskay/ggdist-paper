---
title: "ggdist: Visualizations of Distributions and Uncertainty in the Grammar of Graphics"

author: 
  - name: "Matthew Kay"
    institution: Northwestern University
    email: mjskay@northwestern.edu

abstract: >
  Duis autem vel eum iriure dolor in hendrerit in vulputate
  velit esse molestie consequat, vel illum dolore eu feugiat nulla
  facilisis at vero eros et accumsan et iusto odio dignissim qui blandit
  praesent luptatum zzril delenit augue duis dolore te feugait nulla
  facilisi. Lorem ipsum dolor sit amet, consectetuer adipiscing elit,
  sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna
  aliquam erat volutpat. Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper
  suscipit lobortis nisl ut aliquip ex ea commodo consequat. Duis autem
  vel eum iriure dolor in hendrerit in vulputate velit esse molestie
  consequat, vel illum dolore eu feugiat nulla facilisis at vero eros et
  accumsan et iusto odio dignissim qui blandit praesent luptatum zzril
  delenit augue duis dolore te feugait nulla facilisi.

keywords: Uncertainty visualization, grammar of graphics

# please declare the paper type of your paper to help reviewers, only shown in review mode
# choices:
# * algorithm/technique
# * application/design study
# * evaluation
# * system
# * theory/model
papertype: system

bibliography: template.bib

output:
  bookdown::pdf_document2:
    template: template_rmd.tex
    keep_tex: true
    citation_package: natbib
---

```{r setup_output, include=FALSE}
if (knitr::opts_knit$get('rmarkdown.pandoc.to') == 'latex') {
  knitr::opts_chunk$set(
    fig.width = 4.75,
    fig.height = 3.25,
    out.width = "100%",
    dev = "cairo_pdf",
    # out.extra ensures that knitr uses LaTeX code for figures
    # see https://stackoverflow.com/questions/42486617/knitr-ignoring-fig-pos
    out.extra = ''
  )
}
```

```{r setup, include=FALSE}
library(ggplot2)
library(dplyr)
library(ggdist)
library(magrittr)
library(lubridate)
library(readr)

theme_set(theme_ggdist())
```


- motivate uncertainty visualization, probabilistic visualization (esp in grammar of graphics)
- cf. pgog, ggplot2 paper, vega-lite
- pain to do in existing gog systems; pgog only attempt but focused on area visualizations and (some) dotplots (and there: limited)
- basic idea: reify pdf, cdf, quantile function and make these available for mapping onto visual channels

- eval: discuss arc of project, usage over time, changes based on user needs etc (ref: munzner model, that paper on interactive systems)

# Related work

## Grammar of graphics

## Uncertainty visualization

# Uncertainty visualization in the grammar of graphics

- introduce formalism
- note applicability to confidence distributions as well as probability distributions

```{r cran_downloads, fig.width = 4.75/2, fig.height = 3.25/2, fig.caption = "Downloads of *ggdist* and *tidybayes* over time, as downloads per day, averaged within month."}
if (!file.exists("data/cran_downloads.csv")) {
  cran_downloads = cranlogs::cran_downloads(packages = c("tidybayes", "ggdist"), from = "2018-06-30", to = "2022-02-19")
  write.csv(cran_downloads, file = "data/cran_downloads.csv", row.names = FALSE)
}

cran_downloads = read_csv("data/cran_downloads.csv", col_types = cols(
  date = col_date(),
  count = col_double(),
  package = col_character()
))

refline_ = function(..., x, y, xend = x, yend = y) {
  annotate("segment", x = x, y = y, xend = xend, yend = yend, ...)
}

label_ = function(..., color = "gray50", lineheight = 1) {
  annotate("text", color = color, lineheight = lineheight, ...)
}

cran_downloads %>%
  # ggdist was released on 2020-06-14, so just include that month onwards
  filter(!(package == "ggdist" & date < "2020-06-01")) %>%
  
  # average within month
  within(day(date) <- 1) %>%
  group_by(package, date) %>%
  summarise(count = mean(count), .groups = "drop") %>%
  
  ggplot(aes(x = date, y = count, color = package)) +
  geom_line() +
  geom_point() +
  geom_text(
    aes(label = package), 
    data = . %>% filter(date == max(date)), 
    hjust = 0,
    vjust = 0.3,
    position = position_nudge(x = 20)
  ) +
  refline_(x = as.Date("2020-06-01"), y = 0, yend = 300, alpha = 0.25) +
  label_(x = as.Date("2020-06-01"), y = 310, label = "ggdist released\non CRAN", hjust = 0, vjust = 0) +
  scale_color_brewer(palette = "Dark2") +
  labs(
    x = NULL,
    y = "Average downloads per day"
  ) +
  guides(color = "none") +
  scale_x_date(limits = as.Date(c("2018-06-01", "2022-10-01"))) +
  coord_cartesian(expand = FALSE, clip = "off")
```



Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam
nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat,
sed diam voluptua. At vero eos et accusam et justo duo dolores et ea
rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem
ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur
sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et
dolore magna aliquyam erat, sed diam
voluptua\ [@Kitware:2003; @Max:1995:OMF]. At vero eos et accusam et
justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea
takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit
amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor
invidunt ut labore et dolore magna aliquyam erat, sed diam
voluptua. At vero eos et accusam et justo duo dolores et ea
rebum. Stet clita kasd gubergren, no sea takimata sanctus est.

# Exposition

Duis autem vel eum iriure dolor in hendrerit in vulputate velit esse
molestie consequat, vel illum dolore eu feugiat nulla facilisis at
vero eros et accumsan et iusto odio dignissim qui blandit praesent
luptatum zzril delenit augue duis dolore te feugait nulla
facilisi. Lorem ipsum dolor sit amet, consectetuer adipiscing elit,
sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna
aliquam erat volutpat\ \cite{Kindlmann:1999:SAG}.

$$
\sum_{j=1}^{z} j = \frac{z(z+1)}{2} 
$$

See also Table\ \@ref(tab:mtcars).

```{r mtcars, echo = FALSE}
knitr::kable(mtcars[1:5, 1:5], caption = "The mtcars data.")
```

Here is some code:

```{r}
x = 1:10
x
```

Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam
nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat,
sed diam voluptua. At vero eos et accusam et justo duo dolores et ea
rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem
ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur
sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et
dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam
et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea
takimata sanctus est Lorem ipsum dolor sit amet.

## Lorem ipsum

Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam
nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat,
sed diam voluptua. At vero eos et accusam et justo duo dolores et ea
rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem
ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur
sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et
dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam
et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea
takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit
amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor
invidunt ut labore et dolore magna aliquyam erat, sed diam
voluptua. At vero eos et accusam et justo duo dolores et ea
rebum.

## Mezcal Head

```{r sample, echo=FALSE, fig.cap="A sample of mtcars data"}
mtcars %>%
  ggplot(aes(x = wt, y = mpg)) +
  geom_point()
```

Lorem ipsum dolor sit amet (see Figure\ \@ref(fig:sample)), consetetur sadipscing elitr, sed diam
nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat,
sed diam voluptua. At vero eos et accusam et justo duo dolores et ea
rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem
ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur
sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et
dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam
et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea
takimata sanctus est Lorem ipsum dolor sit amet.


### Duis Autem

Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam
nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat,
sed diam voluptua. At vero eos et accusam et justo duo dolores et ea
rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem
ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur
sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et
dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam
et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea
takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit
amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor
invidunt ut labore et dolore magna aliquyam erat, sed diam
voluptua. At vero eos et accusam et justo duo dolores et ea
rebum. Stet clita kasd gubergren, no sea takimata sanctus est. Lorem
ipsum dolor sit amet.


### Ejector Seat Reservation

Duis autem\ [@Lorensen:1987:MCA]^[The algorithm behind
Marching Cubes\ [@Lorensen:1987:MCA] had already been
described by Wyvill et al.\ [@Wyvill:1986:DSS] a year
earlier.] vel eum iriure dolor in hendrerit
in vulputate velit esse molestie consequat,^[Footnotes
appear at the bottom of the column.] vel illum dolore eu
feugiat nulla facilisis at vero eros et accumsan et iusto odio
dignissim qui blandit praesent luptatum zzril delenit augue duis
dolore te feugait nulla facilisi. Lorem ipsum dolor sit amet,
consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt
ut laoreet dolore magna aliquam erat volutpat.

\paragraph{Confirmed Ejector Seat Reservation}

Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper
suscipit lobortis nisl ut aliquip ex ea commodo
consequat\ [@Nielson:1991:TAD]. Duis autem vel eum iriure dolor in
hendrerit in vulputate velit esse molestie consequat, vel illum dolore
eu feugiat nulla facilisis at vero eros et accumsan et iusto odio
dignissim qui blandit praesent luptatum zzril delenit augue duis
dolore te feugait nulla facilisi.

\paragraph{Rejected Ejector Seat Reservation}

Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper
suscipit lobortis nisl ut aliquip ex ea commodo consequat. Duis autem
vel eum iriure dolor in hendrerit in vulputate velit esse molestie


# Conclusion

Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam
nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat,
sed diam voluptua. At vero eos et accusam et justo duo dolores et ea
rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem
ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur
sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et
dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam
et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea
takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit
amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor
invidunt ut labore et dolore magna aliquyam erat, sed diam
voluptua. At vero eos et accusam et justo duo dolores et ea
rebum.
